{"version":3,"file":"ng-redux.js","sources":["../src/utils/shallowEqual.js","../src/utils/wrapActionCreators.js","../src/components/connector.js","../src/components/digestMiddleware.js","../src/components/ngRedux.js","../src/index.js"],"sourcesContent":[" export default function shallowEqual(objA, objB) {\n   if (objA === objB) {\n     return true;\n   }\n\n   /* $$hashKey is added by angular when using ng-repeat, we ignore that*/\n   var keysA = Object.keys(objA).filter(k => k !== '$$hashKey');\n   var keysB = Object.keys(objB).filter(k => k !== '$$hashKey');\n\n   if (keysA.length !== keysB.length) {\n     return false;\n   }\n\n   // Test for A's keys different from B.\n   var hasOwn = Object.prototype.hasOwnProperty;\n   for (let i = 0; i < keysA.length; i++) {\n     if (!hasOwn.call(objB, keysA[i]) ||\n       objA[keysA[i]] !== objB[keysA[i]]) {\n       return false;\n     }\n   }\n\n   return true;\n }","import { bindActionCreators } from 'redux';\n\nexport default function wrapActionCreators(actionCreators) {\n  return dispatch => bindActionCreators(actionCreators, dispatch);\n}\n","import shallowEqual from '../utils/shallowEqual';\nimport wrapActionCreators from '../utils/wrapActionCreators';\nimport invariant from 'invariant';\n\nimport isPlainObject from 'lodash.isplainobject';\nimport isFunction from 'lodash.isfunction';\nimport isObject from 'lodash.isobject';\n\nconst assign = Object.assign;\nconst defaultMapStateToTarget = () => ({});\nconst defaultMapDispatchToTarget = dispatch => ({dispatch});\n\nexport default function Connector(store) {\n  return (mapStateToTarget, mapDispatchToTarget) => {\n\n    let finalMapStateToTarget = mapStateToTarget || defaultMapStateToTarget;\n\n    const finalMapDispatchToTarget = isPlainObject(mapDispatchToTarget) ?\n      wrapActionCreators(mapDispatchToTarget) :\n      mapDispatchToTarget || defaultMapDispatchToTarget;\n\n    invariant(\n      isFunction(finalMapStateToTarget),\n      'mapStateToTarget must be a Function. Instead received %s.', finalMapStateToTarget\n      );\n\n    invariant(\n      isPlainObject(finalMapDispatchToTarget) || isFunction(finalMapDispatchToTarget),\n      'mapDispatchToTarget must be a plain Object or a Function. Instead received %s.', finalMapDispatchToTarget\n      );\n\n    let slice = getStateSlice(store.getState(), finalMapStateToTarget, false);\n    const isFactory = isFunction(slice);\n\n    if (isFactory) {\n      finalMapStateToTarget = slice;\n      slice = getStateSlice(store.getState(), finalMapStateToTarget);\n    }\n\n    const boundActionCreators = finalMapDispatchToTarget(store.dispatch);\n\n    return (target) => {\n\n      invariant(\n        isFunction(target) || isObject(target),\n        'The target parameter passed to connect must be a Function or a object.'\n        );\n\n      //Initial update\n      updateTarget(target, slice, boundActionCreators);\n\n      const unsubscribe = store.subscribe(() => {\n        const nextSlice = getStateSlice(store.getState(), finalMapStateToTarget);\n        if (!shallowEqual(slice, nextSlice)) {\n          slice = nextSlice;\n          updateTarget(target, slice, boundActionCreators);\n        }\n      });\n      return unsubscribe;\n    }\n\n  }\n}\n\nfunction updateTarget(target, StateSlice, dispatch) {\n  if(isFunction(target)) {\n    target(StateSlice, dispatch);\n  } else {\n    assign(target, StateSlice, dispatch);\n  }\n}\n\nfunction getStateSlice(state, mapStateToScope, shouldReturnObject = true) {\n  const slice = mapStateToScope(state);\n\n  if (shouldReturnObject) {\n    invariant(\n      isPlainObject(slice),\n      '`mapStateToScope` must return an object. Instead received %s.',\n      slice\n      );\n  } else {\n    invariant(\n      isPlainObject(slice) || isFunction(slice),\n      '`mapStateToScope` must return an object or a function. Instead received %s.',\n      slice\n      );\n  }\n\n  return slice;\n}\n","export default function digestMiddleware($rootScope) {\n  return store => next => action => {\n      const res = next(action);\n      $rootScope.$evalAsync(res);\n      return res;\n  };\n}\n","import Connector from './connector';\nimport invariant from 'invariant';\nimport {createStore, applyMiddleware, compose, combineReducers} from 'redux';\nimport digestMiddleware from './digestMiddleware';\n\nimport curry from 'lodash.curry';\nimport isFunction from 'lodash.isfunction';\nimport map from 'lodash.map';\n\nconst isArray = Array.isArray;\n\nconst typeIs = curry((type, val) => typeof val === type);\nconst isObject = typeIs('object');\nconst isString = typeIs('string');\nconst assign  = Object.assign;\n\nexport default function ngReduxProvider() {\n  let _reducer = undefined;\n  let _middlewares = undefined;\n  let _storeEnhancers = undefined;\n  let _firstStoreEnhancers = undefined;\n  let _initialState = undefined;\n  let _reducerIsObject = undefined;\n\n  this.createStoreWith = (reducer, firstStoreEnhancers, middlewares, storeEnhancers, initialState) => {\n    invariant(\n      isFunction(reducer) || isObject(reducer),\n      'The reducer parameter passed to createStoreWith must be a Function or an Object. Instead received %s.',\n      typeof reducer\n    );\n\n    invariant(\n      !storeEnhancers || isArray(storeEnhancers),\n      'The storeEnhancers parameter passed to createStoreWith must be an Array. Instead received %s.',\n      typeof storeEnhancers\n    );\n\n    _reducer = reducer;\n    _reducerIsObject = isObject(reducer);\n    _storeEnhancers = storeEnhancers;\n    _firstStoreEnhancers = firstStoreEnhancers;\n    _middlewares = middlewares || [];\n    _initialState = initialState ||Â {};\n  };\n\n  this.$get = ($injector) => {\n    const resolveMiddleware = middleware => isString(middleware)\n      ? $injector.get(middleware)\n      : middleware;\n\n    const resolvedMiddleware = map(_middlewares, resolveMiddleware);\n\n    const resolveStoreEnhancer = storeEnhancer => isString(storeEnhancer)\n      ? $injector.get(storeEnhancer)\n      : storeEnhancer;\n\n    const resolvedStoreEnhancer = map(_storeEnhancers, resolveStoreEnhancer);\n    const resolvedFirstEnhancers = map(_firstStoreEnhancers, resolveStoreEnhancer);\n    if(_reducerIsObject) {\n      const getReducerKey = key => isString(_reducer[key])\n        ? $injector.get(_reducer[key])\n        : _reducer[key];\n\n      const resolveReducerKey = (result, key) => assign({}, result,\n        { [key]: getReducerKey(key) }\n      );\n\n      const reducersObj = Object\n        .keys(_reducer)\n        .reduce(resolveReducerKey, {});\n\n      _reducer = combineReducers(reducersObj);\n    }\n\n    //digestMiddleware needs to be the last one.\n    resolvedMiddleware.push(digestMiddleware($injector.get('$rootScope')));\n\n    const middleware = applyMiddleware(...resolvedMiddleware);\n    const enhancer = compose(...resolvedFirstEnhancers, middleware, ...resolvedStoreEnhancer);\n    const store =  createStore(_reducer, _initialState, enhancer);\n\n    return assign({}, store, { connect: Connector(store) });\n  };\n\n  this.$get.$inject = ['$injector'];\n}\n","import ngReduxProvider from './components/ngRedux';\n\nexport default angular.module('ngRedux', [])\n  .provider('$ngRedux', ngReduxProvider)\n  .name;"],"names":["shallowEqual","objA","objB","keysA","filter","k","keysB","length","hasOwn","Object","prototype","hasOwnProperty","i","call","wrapActionCreators","actionCreators","bindActionCreators","dispatch","assign","defaultMapStateToTarget","defaultMapDispatchToTarget","Connector","store","mapStateToTarget","mapDispatchToTarget","finalMapStateToTarget","finalMapDispatchToTarget","isPlainObject","isFunction","slice","getStateSlice","getState","isFactory","boundActionCreators","target","isObject","unsubscribe","subscribe","nextSlice","updateTarget","StateSlice","state","mapStateToScope","shouldReturnObject","digestMiddleware","$rootScope","res","next","action","$evalAsync","isArray","Array","typeIs","curry","type","val","isString","ngReduxProvider","_reducer","undefined","_middlewares","_storeEnhancers","_firstStoreEnhancers","_initialState","_reducerIsObject","createStoreWith","reducer","firstStoreEnhancers","middlewares","storeEnhancers","initialState","$get","$injector","resolveMiddleware","middleware","get","resolvedMiddleware","map","resolveStoreEnhancer","storeEnhancer","resolvedStoreEnhancer","resolvedFirstEnhancers","getReducerKey","key","resolveReducerKey","result","reducersObj","reduce","combineReducers","push","applyMiddleware","enhancer","compose","createStore","connect","$inject","angular","module","provider","name"],"mappings":"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"}